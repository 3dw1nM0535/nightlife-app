{"version":3,"sources":["../../../server/routes/bar/bar.js"],"names":["router","Router","post","req","res","data","body","findOne","location","then","bars","json","get","headers","Authorization","API_KEY","response","businesses","business","save","result","barID","businessID","userID","_id","bar","i","N","length","toString","j","L","attendees","push","going_count","position","indexOf","splice"],"mappings":"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","file":"bar.js","sourcesContent":["///////////////////////////////////\n//Find bar request route handler //\n///////////////////////////////////\nimport express from \"express\";\nimport axios from \"axios\";\nimport Businesses from \"../../model/bar\";\n\nimport privateEnv from \"../../config/private_keys\";\n\nconst router = express.Router();\n\n////////////////////////////\n//Find bars route handler //\n////////////////////////////\nrouter.post(\"/find\", (req, res) => {\n  const { data } = req.body;\n  Businesses.findOne({ location: data.location }).then((bars) => {\n    if (bars) {\n      res.json({ bars });\n    } else {\n      axios.get(`https://api.yelp.com/v3/businesses/search?location=${data.location}&categories=bars`, {\n        headers: { Authorization: `Bearer ${privateEnv.API_KEY}` },\n      }).then((response) => {\n        if (response.data) {\n          const { businesses } = response.data;\n          const { location } = req.body.data;\n          const business = new Businesses({\n            businesses,\n            location,\n          });\n          business.save().then((result) => {\n            if (result) {\n              res.json({ bars: result });\n            } else {\n              res.json({});\n            }\n          });\n        }\n      });\n    }\n  });\n});\n\n////////////////////////////////////////////////////////////////////////////////////////\n//Indicate user going to a certain bar & remove user from a certain bar route handler //\n////////////////////////////////////////////////////////////////////////////////////////\nrouter.post(\"/update\", (req, res) => {\n  const { barID, businessID, userID } = req.body.data;\n  Businesses.findOne({ _id: businessID }).then((bar) => {\n    if (bar) {\n      const business = bar;\n      let i = 0;\n      const N = bar.businesses.length;\n      for (i; i < N; i++) {\n        if (business.businesses[i]._id.toString() === barID) {\n          let j = 0;\n          const L = business.businesses[i].attendees.length;\n          if (L === 0) {\n            business.businesses[i].attendees.push(userID);\n            business.businesses[i].going_count++;\n            business.save().then((result) => {\n              res.json({ result });\n            });\n          } else {\n            for (j; j < L; j++) {\n              if (business.businesses[i].attendees[j] === userID) {\n                const position = business.businesses[i].attendees.indexOf(userID);\n                business.businesses[i].attendees.splice(position, 1);\n                business.businesses[i].going_count--;\n                business.save().then((result) => {\n                  res.json({ result });\n                });\n              }\n            }\n          }\n        }\n      }\n    }\n  });\n});\n\nexport default router;\n"]}